<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<title>multi-clock-v2.3</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="theme-color" content="#0055aa">

<!-- ===== EMBEDDED MANIFEST (base64) ===== -->
<link rel="manifest" href="data:application/json;base64,ewogIm5hbWUiOiJNdWx0aS1D bG9jayIsCiAic2hvcnRfbmFtZSI6Ik11bHRpQ2xvY2siLAogInN0YXJ0X3VybCI6Imlu ZGV4Lmh0bWwiLAogImRpc3BsYXkiOiJzdGFuZGFsb25lIiwKICJiYWNrZ3JvdW5kX2Nv bG9yIjoiI2VlZjZmZiIsCiAidGhlbWVfY29sb3IiOiIjMDA1NWFhIiwKICJpY29ucyI6 WwogIHsic3JjIjoiZGF0YTppbWFnZS9wbmc7YmFzZTY0LC4uLjE5MltCQVNFMjQ0SEVS RS1IRVJFXSIsICJzaXplcyI6IjE5MngxOTIiLCAidHlwZSI6ImltYWdlL3BuZyIgfSwK ICB7InNyYyI6ImRhdGE6aW1hZ2UvcG5nO2Jhc2U2NCwuLi4xOTJbQkFTRTY0SEVSRV0i LCAic2l6ZXMiOiI1MTJ4NTEyIiwgInR5cGUiOiJpbWFnZS9wbmcifQogIF0KfQ==">

<!-- ===== EMBEDDED ICONS (base64) ===== -->
<link rel="icon" sizes="192x192" href="data:image/png;base64,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">

<style>
/* ============================================================
   GLOBAL COLORS + THEME
   ============================================================ */
:root {
    --bg: #eef6ff;
    --text-main: #111827;
    --card-bg: #ffffff;
    --card-shadow: rgba(0,0,0,0.15);
    --accent: #0055aa;
    --subtle: #4b5563;
}
body.dark {
    --bg: #060b11;
    --text-main: #e5e7eb;
    --card-bg: #111827;
    --card-shadow: rgba(0,0,0,0.7);
    --accent: #63b3ff;
    --subtle: #9ca3af;
}

body {
    font-family: Arial;
    background: var(--bg);
    color: var(--text-main);
    margin: 0;
    padding: 20px;
    text-align: center;
}

h1 {
    color: var(--accent);
    margin-bottom: 4px;
}

/* ============================================================
   TOP BAR + BUTTONS
   ============================================================ */
#topBar {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 8px;
}

.top-button {
    padding: 6px 12px;
    font-size: 0.9rem;
    border-radius: 999px;
    border: 1px solid #cbd5f5;
    background: #f9fafb;
    cursor: pointer;
}
body.dark .top-button {
    background:#1f2933;
    border-color:#374151;
    color:var(--text-main);
}

.gps-box {
    font-size:0.9rem;
    color:var(--subtle);
    margin-bottom:12px;
}

/* ============================================================
   GRID + CARDS
   ============================================================ */
.section-label {
    margin-top:20px;
    margin-bottom:6px;
    font-size:0.95rem;
    letter-spacing:0.08em;
    text-transform:uppercase;
    color:var(--subtle);
}

.grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap:20px;
}

.card {
    position: relative;
    background: var(--card-bg);
    border-radius: 16px;
    padding: 20px;
    box-shadow: 0 4px 12px var(--card-shadow);
}

.hide-btn {
    position:absolute;
    top:8px;
    right:8px;
    background:rgba(0,0,0,0.25);
    color:white;
    border:none;
    padding:3px 7px;
    border-radius:999px;
    font-size:0.85rem;
    cursor:pointer;
}
body.dark .hide-btn {
    background:rgba(255,255,255,0.25);
}

.zone { font-size:1.2rem; margin-bottom:4px; font-weight:bold; }
.clock { font-size:2rem; color:var(--accent); font-weight:bold; }
.date { font-size:0.9rem; color:var(--subtle); }
.sun  { font-size:0.85rem; color:var(--subtle); margin-top:4px; }

footer {
    margin-top:30px;
    font-size:0.9rem;
    color:var(--subtle);
}
.version {
    display:block;
    font-size:0.85rem;
    margin-top:4px;
}
</style>
</head>

<body>

<h1>multi-clock-v2.3</h1>

<div id="topBar">
    <button id="installBtn" class="top-button" style="display:none;">‚¨á Install App</button>
    <button id="themeToggle" class="top-button">üåô Dark Mode</button>
    <button id="gpsBtn" class="top-button">üìç Get Position</button>
    <button id="restoreAllBtn" class="top-button">Restore All Panels</button>
</div>

<div id="gpsBox" class="gps-box">Press ‚Äúüìç Get Position‚Äù</div>

<!-- ======================================================
     CANADA ZONE CARDS
     ====================================================== -->
<div class="section-label">‚Äî CANADA TIMEZONES ‚Äî</div>
<div class="grid">

    <div class="card" data-card-id="pt">
        <button class="hide-btn" onclick="hideCard(this)">üëÅ</button>
        <div class="zone">Pacific Time (PT)</div>
        <div id="pt" class="clock"></div>
        <div id="ptd" class="date"></div>
        <div id="ptSun" class="sun"></div>
    </div>

    <div class="card" data-card-id="mt">
        <button class="hide-btn" onclick="hideCard(this)">üëÅ</button>
        <div class="zone">Mountain Time (MT)</div>
        <div id="mt" class="clock"></div>
        <div id="mtd" class="date"></div>
        <div id="mtSun" class="sun"></div>
    </div>

    <div class="card" data-card-id="ct">
        <button class="hide-btn" onclick="hideCard(this)">üëÅ</button>
        <div class="zone">Central Time (CT)</div>
        <div id="ct" class="clock"></div>
        <div id="ctd" class="date"></div>
        <div id="ctSun" class="sun"></div>
    </div>

    <div class="card" data-card-id="et">
        <button class="hide-btn" onclick="hideCard(this)">üëÅ</button>
        <div class="zone">Eastern Time (ET)</div>
        <div id="et" class="clock"></div>
        <div id="etd" class="date"></div>
        <div id="etSun" class="sun"></div>
    </div>

    <div class="card" data-card-id="at">
        <button class="hide-btn" onclick="hideCard(this)">üëÅ</button>
        <div class="zone">Atlantic Time (AT)</div>
        <div id="at" class="clock"></div>
        <div id="atd" class="date"></div>
        <div id="atSun" class="sun"></div>
    </div>

    <div class="card" data-card-id="nt">
        <button class="hide-btn" onclick="hideCard(this)">üëÅ</button>
        <div class="zone">Newfoundland Time (NT)</div>
        <div id="nt" class="clock"></div>
        <div id="ntd" class="date"></div>
        <div id="ntSun" class="sun"></div>
    </div>

</div>

<!-- ======================================================
     NO-DST AREAS
     ====================================================== -->
<div class="section-label">‚Äî NO-DST REGIONS ‚Äî</div>

<div class="grid">

    <div class="card" data-card-id="sk">
        <button class="hide-btn" onclick="hideCard(this)">üëÅ</button>
        <div class="zone">Saskatchewan (No DST)</div>
        <div id="sk" class="clock"></div>
        <div id="skd" class="date"></div>
        <div id="skSun" class="sun"></div>
    </div>

    <div class="card" data-card-id="yk">
        <button class="hide-btn" onclick="hideCard(this)">üëÅ</button>
        <div class="zone">Yukon (No DST)</div>
        <div id="yk" class="clock"></div>
        <div id="ykd" class="date"></div>
        <div id="ykSun" class="sun"></div>
    </div>

    <div class="card" data-card-id="nu">
        <button class="hide-btn" onclick="hideCard(this)">üëÅ</button>
        <div class="zone">Nunavut ‚Äì Coral Harbour (No DST)</div>
        <div id="nu" class="clock"></div>
        <div id="nud" class="date"></div>
        <div id="nuSun" class="sun"></div>
    </div>

</div>

<!-- ======================================================
     WORLD CLOCK + TIMER SECTION
     ====================================================== -->
<div class="section-label">‚Äî WORLD CLOCK & TIMER ‚Äî</div>

<div class="grid">

    <!-- WORLD CLOCK -->
    <div class="card world" data-card-id="world">
        <button class="hide-btn" onclick="hideCard(this)">üëÅ</button>
        <div class="zone">World Traveller Clock</div>

        <select id="worldZone">
            <option value="UTC">UTC (Universal)</option>
            <option value="America/New_York">New York</option>
            <option value="America/Los_Angeles">Los Angeles</option>
            <option value="Europe/London">London</option>
            <option value="Europe/Paris">Paris</option>
            <option value="Europe/Rome">Rome</option>
            <option value="Europe/Berlin">Berlin</option>
            <option value="Europe/Amsterdam">Amsterdam</option>
            <option value="Europe/Moscow">Moscow</option>
            <option value="Africa/Cairo">Cairo</option>
            <option value="Asia/Jerusalem">Jerusalem</option>
            <option value="Asia/Dubai">Dubai</option>
            <option value="Asia/Karachi">Karachi</option>
            <option value="Asia/Kolkata">India</option>
            <option value="Asia/Bangkok">Bangkok</option>
            <option value="Asia/Hong_Kong">Hong Kong</option>
            <option value="Asia/Tokyo">Tokyo</option>
            <option value="Australia/Sydney">Sydney</option>
            <option value="Pacific/Auckland">Auckland</option>
        </select>

        <div id="worldClock" class="clock"></div>
        <div id="worldDate" class="date"></div>
        <div id="worldSun" class="sun"></div>
    </div>

    <!-- STOPWATCH + TIMER CARD -->
    <div class="card timer-card" data-card-id="timer">
        <button class="hide-btn" onclick="hideCard(this)">üëÅ</button>
        <div class="zone">Stopwatch & Timer</div>

        <div class="section-title">Stopwatch</div>
        <div id="swDisplay" class="sw-display">00:00:00.0</div>

        <div class="btn-row">
            <button id="swStart">Start</button>
            <button id="swStop">Stop</button>
            <button id="swLap">Lap</button>
            <button id="swReset">Reset</button>
        </div>

        <ul id="lapList" class="lap-list"></ul>

        <div class="section-title" style="margin-top:12px;">Countdown Timer</div>

        <div class="timer-inputs">
            <input type="number" id="tHours" min="0" max="99" placeholder="HH">
            <input type="number" id="tMinutes" min="0" max="59" placeholder="MM">
            <input type="number" id="tSeconds" min="0" max="59" placeholder="SS">
        </div>

        <div id="tDisplay" class="t-display">00:00:00</div>

        <div class="btn-row">
            <button id="tStart">Start</button>
            <button id="tPause">Pause</button>
            <button id="tReset">Reset</button>
        </div>

    </div>

</div>

<footer>
    ¬© 2025 Glen Carruthers ‚Ä¢ All Rights Reserved
    <span class="version">v2.3 Embedded PWA ‚Äî Full Features + Manual GPS</span>
</footer>

<!-- ======================================================
     BEGIN SCRIPT SECTION
     ====================================================== -->
<script>

/* ============================================================
   THEME, INSTALL, HIDE/SHOW PANELS (PERSISTENT)
   ============================================================ */
(function initUI() {

    const installBtn = document.getElementById("installBtn");
    const themeToggle = document.getElementById("themeToggle");
    const restoreAllBtn = document.getElementById("restoreAllBtn");
    let deferredPrompt = null;

    /* Restore theme */
    const saved = localStorage.getItem("multiClockTheme");
    if (saved === "dark") {
        document.body.classList.add("dark");
        themeToggle.textContent = "‚òÄ Light Mode";
    }

    themeToggle.onclick = () => {
        const dark = document.body.classList.toggle("dark");
        themeToggle.textContent = dark ? "‚òÄ Light Mode" : "üåô Dark Mode";
        localStorage.setItem("multiClockTheme", dark ? "dark" : "light");
    };

    /* PWA Install */
    window.addEventListener("beforeinstallprompt", e => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = "inline-block";
    });

    installBtn.onclick = async () => {
        if (!deferredPrompt) return;
        deferredPrompt.prompt();
        const result = await deferredPrompt.userChoice;
        if (result.outcome === "accepted") {
            deferredPrompt = null;
            installBtn.style.display = "none";
        }
    };

    /* Persistent hide/show panels */
    const KEY = "multiClockHidden";
    const loadHidden = () => JSON.parse(localStorage.getItem(KEY) || "[]");
    const saveHidden = list => localStorage.setItem(KEY, JSON.stringify(list));
    const hidden = loadHidden();
    hidden.forEach(id => {
        const card = document.querySelector(`.card[data-card-id="${id}"]`);
        if (card) card.style.display = "none";
    });

    restoreAllBtn.onclick = () => {
        document.querySelectorAll(".card").forEach(c => c.style.display = "block");
        saveHidden([]);
    };

    /* expose for global hideCard() */
    window._hideHelpers = { loadHidden, saveHidden };

})();

/* Hide a panel */
function hideCard(btn) {
    const card = btn.closest(".card");
    const id = card.dataset.cardId;
    card.style.display = "none";

    const { loadHidden, saveHidden } = window._hideHelpers;
    const list = loadHidden();
    if (!list.includes(id)) {
        list.push(id);
        saveHidden(list);
    }
}


/* ============================================================
   GPS ‚Äî ON DEMAND (Option C)
   ============================================================ */
function updateGPS() {
    const box = document.getElementById("gpsBox");

    if (!navigator.geolocation) {
        box.innerHTML = "GPS not supported on this device";
        return;
    }

    box.innerHTML = "Locating...";

    navigator.geolocation.getCurrentPosition(
        pos => {
            const lat = pos.coords.latitude;
            const lon = pos.coords.longitude;

            const ns = lat >= 0 ? "N" : "S";
            const ew = lon >= 0 ? "E" : "W";

            const absLat = Math.abs(lat).toFixed(5);
            const absLon = Math.abs(lon).toFixed(5);

            const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;

            box.innerHTML = `
                Lat: ${absLat}¬∞ ${ns}<br>
                Lon: ${absLon}¬∞ ${ew}<br>
                Timezone: ${tz}
            `;
        },
        err => {
            if (err.code === 1) box.innerHTML = "Location denied";
            else box.innerHTML = "Location unavailable";
        },
        { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
    );
}

document.getElementById("gpsBtn").onclick = updateGPS;


/* ============================================================
   SUNRISE / SUNSET ENGINE (fixed variable names)
   ============================================================ */
function degToRad(x) { return x * Math.PI / 180; }
function radToDeg(x) { return x * 180 / Math.PI; }

function dayOfYear(d) {
    const start = new Date(d.getFullYear(), 0, 0);
    return Math.floor((d - start) / 86400000);
}

function calcSunTime(date, lat, lon, tz, isRise) {

    const Z = 90.833;
    const N = dayOfYear(date);
    const lngHour = lon / 15;

    const t = N + ((isRise ? 6 : 18) - lngHour) / 24;

    const M = 0.9856 * t - 3.289;

    const L_sun = M +
        1.916 * Math.sin(degToRad(M)) +
        0.020 * Math.sin(degToRad(2 * M)) +
        282.634;

    const L_norm = (L_sun % 360 + 360) % 360;

    const RA = radToDeg(Math.atan(0.91764 * Math.tan(degToRad(L_norm))));
    const RA_norm = (RA % 360 + 360) % 360;

    const LQ = Math.floor(L_norm / 90) * 90;
    const RAQ = Math.floor(RA_norm / 90) * 90;

    const RA_hours = (RA_norm + (LQ - RAQ)) / 15;

    const sinDec = 0.39782 * Math.sin(degToRad(L_norm));
    const cosDec = Math.cos(Math.asin(sinDec));

    const cosH = (Math.cos(degToRad(Z)) -
        sinDec * Math.sin(degToRad(lat))) /
        (cosDec * Math.cos(degToRad(lat)));

    if (cosH > 1 || cosH < -1) return "N/A";

    let H = isRise ? 360 - radToDeg(Math.acos(cosH)) : radToDeg(Math.acos(cosH));
    H /= 15;

    const T = H + RA_hours - 0.06571 * t - 6.622;
    const UT = T - lngHour;

    let localT = (UT + tz + 24) % 24;

    const hh = Math.floor(localT);
    const mm = Math.round((localT - hh) * 60);

    return String(hh).padStart(2, "0") + ":" +
        String(mm).padStart(2, "0");
}

/* Sunrise map coordinates */
const SUNLOCS = {
    pt: { lat: 49.28, lon: -123.12, off: -8 },
    mt: { lat: 53.54, lon: -113.49, off: -7 },
    ct: { lat: 49.89, lon: -97.13, off: -6 },
    et: { lat: 43.65, lon: -79.34, off: -5 },
    at: { lat: 44.64, lon: -63.57, off: -4 },
    nt: { lat: 47.56, lon: -52.71, off: -3.5 },
    sk: { lat: 50.44, lon: -104.61, off: -6 },
    yk: { lat: 60.72, lon: -135.05, off: -7 },
    nu: { lat: 64.13, lon: -83.17, off: -5 }
};

function updateSun(id, key) {
    const L = SUNLOCS[key];
    const sr = calcSunTime(new Date(), L.lat, L.lon, L.off, true);
    const ss = calcSunTime(new Date(), L.lat, L.lon, L.off, false);

    document.getElementById(id).textContent =
        `Sunrise: ${sr} | Sunset: ${ss}`;
}


/* ============================================================
   CLOCK & DATE UPDATES
   ============================================================ */
function updateClock(id, zone) {
    document.getElementById(id).textContent =
        new Date().toLocaleTimeString("en-CA", {
            timeZone: zone,
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit"
        });
}

function updateDate(id, zone) {
    document.getElementById(id).textContent =
        new Date().toLocaleDateString("en-CA", {
            timeZone: zone,
            weekday: "short",
            year: "numeric",
            month: "2-digit",
            day: "2-digit"
        });
}

function updateWorld() {
    const zone = document.getElementById("worldZone").value;
    updateClock("worldClock", zone);
    updateDate("worldDate", zone);
    document.getElementById("worldSun").textContent = "";
}


/* ============================================================
   MASTER UPDATE FUNCTION (runs every second)
   ============================================================ */
function updateAll() {

    updateClock("pt", "America/Vancouver");
    updateDate("ptd", "America/Vancouver");
    updateSun("ptSun", "pt");

    updateClock("mt", "America/Edmonton");
    updateDate("mtd", "America/Edmonton");
    updateSun("mtSun", "mt");

    updateClock("ct", "America/Winnipeg");
    updateDate("ctd", "America/Winnipeg");
    updateSun("ctSun", "ct");

    updateClock("et", "America/Toronto");
    updateDate("etd", "America/Toronto");
    updateSun("etSun", "et");

    updateClock("at", "America/Halifax");
    updateDate("atd", "America/Halifax");
    updateSun("atSun", "at");

    updateClock("nt", "America/St_Johns");
    updateDate("ntd", "America/St_Johns");
    updateSun("ntSun", "nt");

    updateClock("sk", "America/Regina");
    updateDate("skd", "America/Regina");
    updateSun("skSun", "sk");

    updateClock("yk", "America/Whitehorse");
    updateDate("ykd", "America/Whitehorse");
    updateSun("ykSun", "yk");

    updateClock("nu", "America/Coral_Harbour");
    updateDate("nud", "America/Coral_Harbour");
    updateSun("nuSun", "nu");

    updateWorld();
}

document.getElementById("worldZone").onchange = updateWorld;

updateAll();
setInterval(updateAll, 1000);
/* ============================================================
   STOPWATCH MODULE
   ============================================================ */
let swInterval = null;
let swRunning = false;
let swStartTime = 0;
let swElapsed = 0;
let lapCount = 0;

const swDisp = document.getElementById("swDisplay");
const lapList = document.getElementById("lapList");

function fmtSW(ms) {
    let totalSeconds = Math.floor(ms / 1000);
    let h = Math.floor(totalSeconds / 3600);
    let m = Math.floor((totalSeconds % 3600) / 60);
    let s = totalSeconds % 60;
    let t = Math.floor((ms % 1000) / 100);
    return (
        String(h).padStart(2, "0") + ":" +
        String(m).padStart(2, "0") + ":" +
        String(s).padStart(2, "0") + "." + t
    );
}

function tickSW() {
    swElapsed = Date.now() - swStartTime;
    swDisp.textContent = fmtSW(swElapsed);
}

document.getElementById("swStart").onclick = () => {
    if (!swRunning) {
        swRunning = true;
        swStartTime = Date.now() - swElapsed;
        swInterval = setInterval(tickSW, 100);
    }
};

document.getElementById("swStop").onclick = () => {
    if (swRunning) {
        swRunning = false;
        clearInterval(swInterval);
        tickSW();
    }
};

document.getElementById("swLap").onclick = () => {
    if (swElapsed > 0) {
        lapCount++;
        const li = document.createElement("li");
        li.textContent = `Lap ${lapCount}: ${fmtSW(swElapsed)}`;
        lapList.prepend(li);
    }
};

document.getElementById("swReset").onclick = () => {
    swRunning = false;
    clearInterval(swInterval);
    swElapsed = 0;
    lapCount = 0;
    swDisp.textContent = "00:00:00.0";
    lapList.innerHTML = "";
};


/* ============================================================
   COUNTDOWN TIMER MODULE
   ============================================================ */
let tInterval = null;
let tRemaining = 0;
let tRunning = false;

const tDisp = document.getElementById("tDisplay");

function fmtTimer(ms) {
    const secs = Math.max(0, Math.floor(ms / 1000));
    const h = Math.floor(secs / 3600);
    const m = Math.floor((secs % 3600) / 60);
    const s = secs % 60;
    return (
        String(h).padStart(2, "0") + ":" +
        String(m).padStart(2, "0") + ":" +
        String(s).padStart(2, "0")
    );
}

function tickTimer() {
    tRemaining -= 1000;

    if (tRemaining <= 0) {
        tRemaining = 0;
        tDisp.textContent = "00:00:00";
        clearInterval(tInterval);
        tRunning = false;
        alert("Timer finished!");
    } else {
        tDisp.textContent = fmtTimer(tRemaining);
    }
}

document.getElementById("tStart").onclick = () => {
    if (!tRunning) {
        if (tRemaining <= 0) {
            const h = +document.getElementById("tHours").value || 0;
            const m = +document.getElementById("tMinutes").value || 0;
            const s = +document.getElementById("tSeconds").value || 0;
            tRemaining = (h * 3600 + m * 60 + s) * 1000;

            if (tRemaining <= 0) return;
        }

        tRunning = true;
        tInterval = setInterval(tickTimer, 1000);
    }
};

document.getElementById("tPause").onclick = () => {
    if (tRunning) {
        tRunning = false;
        clearInterval(tInterval);
    }
};

document.getElementById("tReset").onclick = () => {
    tRunning = false;
    clearInterval(tInterval);
    tRemaining = 0;
    tDisp.textContent = "00:00:00";
};


/* ============================================================
   OFFLINE SERVICE WORKER (embedded logic)
   ============================================================ */
if ("serviceWorker" in navigator) {
    window.addEventListener("load", () => {
        navigator.serviceWorker.register("sw.js").catch(() => {});
    });
}

</script>

</body>
</html>
